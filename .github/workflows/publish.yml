name: Publish to Nuget

on: workflow_dispatch

jobs:
  publish:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - uses: actions/checkout@v3
      - name: Setup .NET
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: 
            6.0.x
            7.0.x
    
      - name: Restore Dependencies
        run: dotnet restore
    
      - name: Build
        run: dotnet build -c Release --no-restore
      
      - name: Pack
        run: dotnet pack -c Release
        
      - name: Publish to Nuget
        run: |
          dotnet nuget push src/DrillSergeant/bin/Release/*.nupkg -k ${{secrets.NUGET_API_KEY}} -s https://api.nuget.org/v3/index.json --skip-duplicate
          dotnet nuget push src/DrillSergeant.MSTest/bin/Release/*.nupkg -k ${{secrets.NUGET_API_KEY}} -s https://api.nuget.org/v3/index.json --skip-duplicate
          dotnet nuget push src/DrillSergeant.Xunit2/bin/Release/*.nupkg -k ${{secrets.NUGET_API_KEY}} -s https://api.nuget.org/v3/index.json --skip-duplicate
          dotnet nuget push src/DrillSergeant.NUnit3/bin/Release/*.nupkg -k ${{secrets.NUGET_API_KEY}} -s https://api.nuget.org/v3/index.json --skip-duplicate
